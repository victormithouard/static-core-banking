<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Aether: AI Impact on Core Banking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Chosen Palette: Deep Indigo/Violet (Tech/AI) with Slate/Zinc (Hardware/Infrastructure) -->
    <!-- Application Structure Plan:
         1. Executive Overview: The "Probabilistic vs. Deterministic" conflict defined.
         2. The AI Stack (Lanes): From Silicon (NVIDIA) to Service (Chatbots).
         3. Player Atlas: Categorized by 'AI Enablers' (Infra), 'Adopters' (Banks), and 'Defenders' (Legacy Cores).
         4. Impact Matrices: 'Hype vs. Reality' scatter plot and 'Budget Shift' charts.
         5. Qualitative Deep Dives: Use Cases (Coding, Service, Fraud), Risks (Hallucinations), and Regulation (EU AI Act).
    -->
    <!-- Visualization & Content Choices:
         - Impact Matrix: Scatter Plot (Chart.js). Goal: Compare. Use Case Impact vs. Regulatory Risk.
         - Budget Shift: Stacked Bar. Goal: Inform. Shift from "Run the Bank" to "Change the Bank (AI)".
         - Lane Map: Interactive Flexbox. Goal: Explain. The flow of value from GPU -> Model -> App.
         - AI Integration: 'Thesis' button now generates an "AI Readiness Scorecard".
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', system-ui, sans-serif;
            background-color: #f8fafc;
            color: #0f172a;
        }

        /* Lane Styling */
        .lane-card {
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 4px solid transparent;
        }

        .lane-card:hover {
            transform: translateY(-2px);
            shadow: md;
        }

        .lane-card.active {
            border-left-color: #6366f1;
            background-color: #e0e7ff;
            color: #312e81;
        }

        /* Tab Styling */
        .tab-btn {
            transition: all 0.2s ease;
            border-bottom: 2px solid transparent;
        }

        .tab-btn.active {
            border-color: #6366f1;
            color: #4338ca;
            font-weight: 600;
        }

        /* Card Styling */
        .player-card {
            transition: transform 0.2s;
        }

        .player-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        /* AI Drawer */
        .ai-drawer {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateX(100%);
        }

        .ai-drawer.open {
            transform: translateX(0);
        }

        /* Markdown Overrides */
        .prose strong {
            color: #312e81;
        }

        .prose ul {
            list-style-type: disc;
            padding-left: 1.25em;
        }
    </style>
</head>

<body class="text-slate-800">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm backdrop-blur-md bg-opacity-90">
        <div class="max-w-7xl mx-auto px-4 py-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold text-slate-900 tracking-tight flex items-center gap-2">
                        PROJECT <span class="text-indigo-600">AETHER</span>
                    </h1>
                    <p class="text-xs text-slate-500 font-medium">AI & GENAI IMPACT ON CORE BANKING ‚Ä¢ 2025-2026</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="toggleAIChat()"
                        class="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-indigo-700 transition flex items-center gap-2 shadow-sm font-medium">
                        <span class="text-lg">ü§ñ</span> AI Strategist
                    </button>
                    <button onclick="scrollToSection('watchlist')"
                        class="bg-slate-800 text-white px-4 py-2 rounded-lg text-sm hover:bg-slate-700 transition font-medium">Risks
                        & Watchlist</button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-12 relative">

        <!-- Executive Overview -->
        <section class="bg-gradient-to-br from-indigo-50 to-white rounded-xl p-6 shadow-sm border border-indigo-100">
            <h2 class="text-lg font-bold mb-3 uppercase tracking-wide text-indigo-900 flex items-center gap-2">
                Executive Overview <span
                    class="px-2 py-0.5 bg-indigo-100 text-indigo-700 text-xs rounded-full">Thesis</span>
            </h2>
            <p class="text-slate-700 leading-relaxed mb-4 text-sm md:text-base">
                The integration of GenAI into Core Banking represents a clash between the <strong>Probabilistic</strong>
                (AI models) and the <strong>Deterministic</strong> (Ledgers). While GenAI will not replace the core
                transaction engine in the near term (due to hallucination risk), it is aggressively "hollowing it out"
                by taking over coding, migration, customer service, and data analytics layers.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                <div class="bg-white p-4 rounded-lg border border-slate-200 shadow-sm">
                    <span class="font-bold block text-slate-900 mb-1">The "Copilot" Era</span>
                    Efficiency play. GenAI writes 40% of legacy migration code (COBOL to Java) and handles L1 support,
                    but doesn't touch the balance sheet.
                </div>
                <div class="bg-white p-4 rounded-lg border border-slate-200 shadow-sm">
                    <span class="font-bold block text-slate-900 mb-1">Data Gravity</span>
                    Legacy cores (FIS, Mainframes) hold the transaction data. The winners will be those who can safely
                    pipe this data to LLMs (RAG pipelines).
                </div>
                <div class="bg-white p-4 rounded-lg border border-slate-200 shadow-sm">
                    <span class="font-bold block text-slate-900 mb-1">The New Upstream</span>
                    Value is leaking upstream to Hyperscalers (Azure/OpenAI, Google/Gemini) and Hardware (NVIDIA),
                    creating a new tax on banking IT.
                </div>
            </div>
        </section>

        <!-- Unit of Competition: The AI Stack -->
        <section>
            <div class="mb-4">
                <h2 class="text-2xl font-bold text-slate-900">1. The AI Banking Stack</h2>
                <p class="text-slate-600 mt-2 max-w-3xl text-sm">
                    Value is shifting. The traditional "Core" is being squeezed between upstream intelligence providers
                    and downstream distribution.
                </p>
            </div>

            <!-- Interactive Lane Diagram -->
            <div class="grid grid-cols-1 md:grid-cols-5 gap-3 mb-6 select-none" id="lane-container">
                <!-- Generated by JS -->
            </div>

            <div id="lane-details"
                class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 min-h-[160px] transition-all relative overflow-hidden">
                <div
                    class="absolute top-0 right-0 p-4 opacity-10 text-9xl text-indigo-900 font-bold select-none leading-none -mt-4 -mr-4 pointer-events-none">
                    AI</div>
                <h3 class="font-bold text-xl text-slate-900" id="lane-title">Select a Layer</h3>
                <p class="text-slate-600 mt-2 text-sm md:text-base" id="lane-desc">Click the stack above to analyze
                    value capture.</p>
                <div class="mt-4 pt-4 border-t border-slate-100">
                    <span class="text-xs font-bold text-slate-400 uppercase">Key Players</span>
                    <p class="font-mono text-sm text-indigo-600 mt-1 font-medium" id="lane-peers">-</p>
                </div>
            </div>
        </section>

        <!-- Player Atlas -->
        <section>
            <div class="flex flex-col md:flex-row justify-between items-end mb-6 border-b border-slate-200 pb-2">
                <div>
                    <h2 class="text-2xl font-bold text-slate-900">2. Player Atlas</h2>
                    <p class="text-slate-600 mt-1 text-sm">Who captures the AI surplus?</p>
                </div>
                <div class="mt-4 md:mt-0">
                    <label class="text-xs font-bold text-slate-500 mr-2 uppercase">Category:</label>
                    <select id="player-filter"
                        class="bg-white border border-slate-300 rounded-lg px-3 py-1.5 text-sm focus:outline-none focus:border-indigo-500 shadow-sm">
                        <option value="all">All Players</option>
                        <option value="Enabler">Infra/Model Enablers</option>
                        <option value="Incumbent">Core Incumbents</option>
                        <option value="Disruptor">AI-First Fintechs</option>
                    </select>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="player-grid">
                <!-- Populated by JS -->
            </div>
        </section>

        <!-- Comparative Matrices -->
        <section class="bg-slate-50 rounded-xl p-8 border border-slate-200">
            <h2 class="text-2xl font-bold text-slate-900 mb-6">3. Impact Analysis</h2>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                <!-- Chart 1: Impact vs Risk -->
                <div>
                    <div class="mb-4">
                        <h3 class="font-bold text-lg text-slate-800">Use Case Matrix: Value vs. Risk</h3>
                        <p class="text-xs text-slate-500">Why banks start with Coding & Service, not Ledgers.</p>
                    </div>
                    <div class="chart-container bg-white p-4 rounded-xl shadow-sm border border-slate-100">
                        <canvas id="impactMap"></canvas>
                    </div>
                    <div class="mt-4 text-xs text-slate-500 italic text-center">
                        *X: Regulatory/Hallucination Risk. Y: Business Value (Cost/Rev).
                    </div>
                </div>

                <!-- Chart 2: Budget Shift -->
                <div>
                    <div class="mb-4">
                        <h3 class="font-bold text-lg text-slate-800">IT Budget Reallocation (2023-2027E)</h3>
                        <p class="text-xs text-slate-500">The "AI Tax" is eating into maintenance budgets.</p>
                    </div>
                    <div class="chart-container bg-white p-4 rounded-xl shadow-sm border border-slate-100">
                        <canvas id="budgetShift"></canvas>
                    </div>
                    <div class="mt-4 text-xs text-slate-500 italic text-center">
                        *Shift from KTLO (Keep The Lights On) to AI/Data Ops.
                    </div>
                </div>
            </div>
        </section>

        <!-- Qualitative Deep Dives -->
        <section>
            <div class="flex border-b border-slate-300 mb-6 overflow-x-auto no-scrollbar">
                <button class="tab-btn active px-6 py-3 text-slate-600 focus:outline-none whitespace-nowrap"
                    onclick="switchTab('usecases', this)">Top Use Cases</button>
                <button class="tab-btn px-6 py-3 text-slate-600 focus:outline-none whitespace-nowrap"
                    onclick="switchTab('risks', this)">Risks & Hallucinations</button>
                <button class="tab-btn px-6 py-3 text-slate-600 focus:outline-none whitespace-nowrap"
                    onclick="switchTab('regulation', this)">Regulation (AI Act)</button>
            </div>

            <div id="tab-content" class="bg-white p-6 rounded-xl shadow-sm min-h-[250px] border border-slate-100">
                <!-- Dynamic Content -->
            </div>
        </section>

        <!-- Watchlist -->
        <section id="watchlist" class="bg-slate-900 text-slate-100 rounded-xl p-8 shadow-lg">
            <h2 class="text-xl font-bold mb-4 border-b border-slate-700 pb-2 flex items-center gap-2">
                <span>‚ö†Ô∏è</span> Risks & Watchlist
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                    <h3 class="text-indigo-400 text-xs font-bold uppercase mb-3 tracking-wider">Existential Risks</h3>
                    <ul class="space-y-3 text-sm">
                        <li class="flex gap-3">
                            <span class="text-red-400 font-bold">1.</span>
                            <span><strong>Model Collapse/Poisoning:</strong> If core data is trained on synthetic data
                                recursively, decision quality (credit risk) degrades.</span>
                        </li>
                        <li class="flex gap-3">
                            <span class="text-red-400 font-bold">2.</span>
                            <span><strong>Vendor Lock-in 2.0:</strong> Moving from Oracle DB lock-in to Vector DB +
                                Model ecosystem lock-in (e.g., Azure fabric).</span>
                        </li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-indigo-400 text-xs font-bold uppercase mb-3 tracking-wider">KPIs to Track</h3>
                    <ul class="space-y-3 text-sm">
                        <li class="flex justify-between items-center border-b border-slate-800 pb-2">
                            <span>"Deflection Rate" (AI Chatbots)</span>
                            <span class="text-green-400 font-mono">Target: >60%</span>
                        </li>
                        <li class="flex justify-between items-center border-b border-slate-800 pb-2">
                            <span>Legacy Migration Speed</span>
                            <span class="text-indigo-400 font-mono">+40% w/ GenAI</span>
                        </li>
                        <li class="flex justify-between items-center pb-2">
                            <span>GPU/Inference Cost %</span>
                            <span class="text-red-400 font-mono">Rising</span>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <footer class="text-center text-xs text-slate-400 py-8">
            <p>Generated for "Project Aether" ‚Ä¢ Sources: Investor Days, Technical Blogs, Market Analysis</p>
        </footer>

    </main>

    <!-- AI Chat Drawer -->
    <div id="ai-chat-drawer"
        class="ai-drawer fixed inset-y-0 right-0 w-full sm:w-[450px] bg-white shadow-2xl z-[60] flex flex-col border-l border-slate-200">
        <div class="p-4 border-b border-slate-200 bg-slate-50 flex justify-between items-center">
            <div>
                <h3 class="font-bold text-slate-900 flex items-center gap-2">ü§ñ AI Strategist</h3>
                <p class="text-xs text-slate-500">Ask about AI implementation, vendors, or risks.</p>
            </div>
            <button onclick="toggleAIChat()"
                class="text-slate-400 hover:text-slate-600 p-2 hover:bg-slate-200 rounded-full transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>

        <div id="chat-history" class="flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50/50">
            <!-- Initial Message -->
            <div class="flex items-start gap-3">
                <div class="bg-indigo-600 p-1.5 rounded-lg text-xs text-white">AI</div>
                <div
                    class="bg-white border border-slate-200 p-3 rounded-2xl rounded-tl-none text-sm text-slate-800 shadow-sm">
                    I am the Aether Strategist. Ask me about the "AI Tax" on banks, which incumbents are successfully
                    pivoting, or the risks of GenAI in credit scoring.
                </div>
            </div>
        </div>

        <div class="p-4 border-t border-slate-200 bg-white">
            <div class="flex gap-2">
                <input type="text" id="chat-input" placeholder="E.g., Risks of GenAI in lending..."
                    class="flex-1 bg-slate-100 border-0 rounded-lg px-4 py-2.5 text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none text-slate-900 placeholder-slate-400"
                    onkeypress="handleChatKeypress(event)">
                <button onclick="sendChatMessage()" id="send-btn"
                    class="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-indigo-700 transition font-medium">
                    Send
                </button>
            </div>
        </div>
    </div>

    <!-- Modal for Thesis Generation -->
    <div id="thesis-modal"
        class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm hidden z-[70] flex items-center justify-center p-4">
        <div
            class="bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[85vh] flex flex-col overflow-hidden animate-[fadeIn_0.2s_ease-out]">
            <div class="p-4 border-b border-slate-200 flex justify-between items-center bg-indigo-50">
                <h3 class="font-bold text-lg text-indigo-900" id="thesis-title">Generating AI Scorecard...</h3>
                <button onclick="closeThesisModal()" class="text-slate-400 hover:text-slate-600">&times;</button>
            </div>
            <div class="p-8 overflow-y-auto prose prose-sm max-w-none prose-indigo" id="thesis-content">
                <div class="flex flex-col items-center justify-center py-12 space-y-4">
                    <div class="animate-spin rounded-full h-10 w-10 border-4 border-indigo-100 border-t-indigo-600">
                    </div>
                    <p class="text-slate-500 font-medium">Analyzing GitHub repositories, investor transcripts, and API
                        docs...</p>
                </div>
            </div>
            <div class="p-4 border-t border-slate-200 text-right bg-slate-50">
                <button onclick="closeThesisModal()"
                    class="bg-slate-800 text-white px-6 py-2 rounded-lg text-sm hover:bg-slate-700 font-medium transition">Close</button>
            </div>
        </div>
    </div>

    <script src="gemini-client.js"></script>

    <script>
        // --- DATA STORE ---

        const lanes = [
            {
                id: 'infra',
                title: '1. Compute & Foundation',
                desc: 'The "Picks and Shovels". GPUs, Cloud Centers, and Foundation Models (LLMs). High Margin.',
                peers: 'NVIDIA, Microsoft Azure, Google Cloud (Vertex AI), OpenAI'
            },
            {
                id: 'data',
                title: '2. Data Fabric',
                desc: 'Vector Databases and Data Lakes. Cleaning the legacy mess for AI consumption (RAG).',
                peers: 'Snowflake, Databricks, MongoDB, Microsoft Fabric'
            },
            {
                id: 'core',
                title: '3. Deterministic Core',
                desc: 'The Ledger. NO GENAI HERE. Must be 100% accurate. "The System of Record".',
                peers: 'Temenos Transact, Oracle FLEXCUBE, Thought Machine Vault'
            },
            {
                id: 'copilot',
                title: '4. Copilot Layer',
                desc: 'The "AI Wrapper". Assistants for staff: Coding, Compliance, Risk, and Support.',
                peers: 'Microsoft Copilot, Glean, Custom Bank Internal Tools'
            },
            {
                id: 'cx',
                title: '5. Distribution / CX',
                desc: 'Hyper-personalization, Chatbots, Biometric Auth. The "Face" of the bank.',
                peers: 'Salesforce (Einstein), Kasisto, Amelia, Intercom'
            }
        ];

        const players = [
            {
                name: 'NVIDIA',
                type: 'Enabler',
                focus: 'Hardware / Compute',
                ai_strat: 'Selling the factory floor. Sovereign AI clouds.',
                risk: 'Cyclicality, competition from custom silicon (Google TPU).',
                impact: 'High (Upstream Tax)',
                score: 'A+'
            },
            {
                name: 'Temenos',
                type: 'Incumbent',
                focus: 'Core Banking',
                ai_strat: 'Explainable AI (XAI) for credit. Generative coding assistants for migration.',
                risk: 'Being commoditized to a "dumb ledger".',
                impact: 'Medium',
                score: 'B'
            },
            {
                name: 'Klarna',
                type: 'Disruptor',
                focus: 'Payments / BNPL',
                ai_strat: 'Aggressive replacement of support staff with AI. "AI-first" UI.',
                risk: 'Regulatory backlash on staffing/bias.',
                impact: 'High (Labor arb)',
                score: 'A'
            },
            {
                name: 'Microsoft',
                type: 'Enabler',
                focus: 'Cloud / Models',
                ai_strat: 'The OS of AI Banking (Azure + OpenAI + Copilot).',
                risk: 'Antitrust, Data privacy concerns.',
                impact: 'Very High',
                score: 'A+'
            },
            {
                name: 'JPMorgan Chase',
                type: 'Incumbent',
                focus: 'Universal Bank',
                ai_strat: '"IndexGPT". Spending $12B/yr on tech. Building proprietary LLMs.',
                risk: 'Execution risk at massive scale.',
                impact: 'High (Leader)',
                score: 'A-'
            },
            {
                name: 'Thought Machine',
                type: 'Incumbent',
                focus: 'Core (Cloud Native)',
                ai_strat: 'Smart Contracts generated by AI. Clean data structure ideal for AI.',
                risk: 'Niche focus.',
                impact: 'Medium',
                score: 'B+'
            }
        ];

        const tabContent = {
            usecases: `
                <div class="space-y-4 animate-fadeIn">
                    <h3 class="text-lg font-bold text-slate-900">High-ROI AI Use Cases</h3>
                    <div class="grid grid-cols-1 gap-3">
                        <div class="flex items-start gap-3 bg-white p-3 rounded border border-slate-100">
                            <div class="bg-green-100 text-green-700 p-2 rounded text-xs font-bold">1</div>
                            <div>
                                <strong class="block text-sm text-slate-800">Legacy Code Migration (COBOL to Java)</strong>
                                <p class="text-xs text-slate-600 mt-1">LLMs are excellent at translation. Banks use this to escape mainframe lock-in 40% faster. <span class="text-indigo-600 font-medium">Impact: Cost Reduction</span></p>
                            </div>
                        </div>
                        <div class="flex items-start gap-3 bg-white p-3 rounded border border-slate-100">
                            <div class="bg-blue-100 text-blue-700 p-2 rounded text-xs font-bold">2</div>
                            <div>
                                <strong class="block text-sm text-slate-800">Customer Service Automation</strong>
                                <p class="text-xs text-slate-600 mt-1">GenAI chatbots (not script-bots) handling complex queries. Klarna reports doing work of 700 agents. <span class="text-indigo-600 font-medium">Impact: Labor Arbitrage</span></p>
                            </div>
                        </div>
                        <div class="flex items-start gap-3 bg-white p-3 rounded border border-slate-100">
                            <div class="bg-purple-100 text-purple-700 p-2 rounded text-xs font-bold">3</div>
                            <div>
                                <strong class="block text-sm text-slate-800">Hyper-Personalized Marketing</strong>
                                <p class="text-xs text-slate-600 mt-1">Generating unique images/copy for every user segment. <span class="text-indigo-600 font-medium">Impact: Revenue Growth</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            `,
            risks: `
                <div class="space-y-4 animate-fadeIn">
                    <div class="bg-red-50 p-4 rounded-lg border border-red-100">
                        <h4 class="font-bold text-red-800 mb-2 text-sm flex items-center gap-2">üö´ The "Hallucination" Firewall</h4>
                        <p class="text-sm text-red-700">Banks cannot use LLMs for ledger calculations. If an LLM says "2+2=5" once in a million transactions, the bank loses its license. <br><br><strong>Architectural Result:</strong> AI is kept in the "Probabilistic Layer" (Service/Advice), strictly firewalled from the "Deterministic Layer" (Ledger/Balance).</p>
                    </div>
                    <ul class="list-disc list-inside space-y-2 text-sm text-slate-700 mt-4">
                        <li><strong>Bias Amplification:</strong> Lending models trained on historical data may reinforce redlining.</li>
                        <li><strong>Shadow AI:</strong> Employees using unapproved ChatGPT instances with sensitive data.</li>
                    </ul>
                </div>
            `,
            regulation: `
                <div class="space-y-4 animate-fadeIn">
                    <h3 class="text-lg font-bold text-slate-900">Regulatory Headwinds</h3>
                    <table class="w-full text-sm text-left">
                        <thead class="bg-slate-100 text-slate-600 font-bold">
                            <tr>
                                <th class="p-2">Regime</th>
                                <th class="p-2">Impact on Banking</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-100">
                            <tr>
                                <td class="p-2 font-semibold text-indigo-900">EU AI Act</td>
                                <td class="p-2">Classifies "Credit Scoring" as <strong>High Risk</strong>. Requires human oversight, audit trails, and bias testing.</td>
                            </tr>
                             <tr>
                                <td class="p-2 font-semibold text-indigo-900">US (CFPB)</td>
                                <td class="p-2">Focus on "Explainability". Banks must explain <em>specifically</em> why a loan was denied (cannot say "The AI said so").</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `
        };

        // --- DOM MANIPULATION ---

        function initLanes() {
            const container = document.getElementById('lane-container');
            lanes.forEach((lane, index) => {
                const el = document.createElement('div');
                el.className = `lane-card bg-white p-4 rounded-lg shadow-sm border border-slate-200 text-sm flex flex-col items-center justify-center h-24 text-center hover:shadow-md ${index === 2 ? 'border-l-indigo-500 bg-indigo-50/50' : ''}`;
                el.innerHTML = `<span class="font-bold text-slate-800 block mb-1">${lane.title}</span>`;
                el.onclick = () => selectLane(lane, el);
                container.appendChild(el);
            });
            // Default selection
            selectLane(lanes[0], container.children[0]);
        }

        function selectLane(lane, element) {
            document.querySelectorAll('.lane-card').forEach(c => c.classList.remove('active'));
            element.classList.add('active');

            document.getElementById('lane-title').textContent = lane.title;
            document.getElementById('lane-desc').textContent = lane.desc;
            document.getElementById('lane-peers').textContent = lane.peers;
        }

        function renderPlayers(filterType = 'all') {
            const grid = document.getElementById('player-grid');
            grid.innerHTML = '';

            const filtered = filterType === 'all' ? players : players.filter(p => p.type === filterType);

            filtered.forEach(p => {
                const card = document.createElement('div');
                card.className = 'player-card bg-white p-5 rounded-xl border border-slate-200 shadow-sm flex flex-col justify-between h-full';

                let badgeClass = '';
                if (p.type === 'Enabler') badgeClass = 'bg-purple-100 text-purple-700';
                else if (p.type === 'Incumbent') badgeClass = 'bg-slate-100 text-slate-700';
                else badgeClass = 'bg-indigo-100 text-indigo-700';

                card.innerHTML = `
                    <div>
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="font-bold text-lg text-slate-900">${p.name}</h3>
                            <span class="text-[10px] uppercase font-bold px-2 py-1 rounded ${badgeClass}">${p.type}</span>
                        </div>
                        <p class="text-xs text-slate-500 mb-3 font-medium uppercase tracking-wide">${p.focus}</p>
                        
                        <div class="space-y-3 text-sm text-slate-600 mb-4">
                            <p class="leading-relaxed"><strong class="text-slate-900">AI Strategy:</strong> ${p.ai_strat}</p>
                            <p class="text-xs bg-red-50 text-red-700 p-2 rounded"><strong>Risk:</strong> ${p.risk}</p>
                        </div>
                    </div>
                    <div class="mt-auto pt-4 border-t border-slate-100 flex justify-between items-center">
                         <div class="flex items-center gap-1">
                            <span class="text-xs text-slate-400 font-bold">READINESS</span>
                            <span class="text-sm font-bold text-indigo-600">${p.score}</span>
                        </div>
                        <button onclick="generateThesis('${p.name}')" class="text-xs bg-white border border-indigo-200 text-indigo-700 px-3 py-1.5 rounded-lg hover:bg-indigo-50 transition flex items-center gap-1 shadow-sm font-medium">
                            <span>‚ú®</span> Scorecard
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function switchTab(tabId, btn) {
            document.getElementById('tab-content').innerHTML = tabContent[tabId];
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        // --- AI LOGIC ---

        function toggleAIChat() {
            document.getElementById('ai-chat-drawer').classList.toggle('open');
        }

        function handleChatKeypress(e) {
            if (e.key === 'Enter') sendChatMessage();
        }

        async function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const history = document.getElementById('chat-history');
            const query = input.value.trim();
            if (!query) return;

            // User Msg
            history.innerHTML += `
                <div class="flex items-start gap-3 justify-end animate-fadeIn">
                    <div class="bg-indigo-600 p-3 rounded-2xl rounded-tr-none text-sm text-white shadow-sm max-w-[85%]">
                        ${query}
                    </div>
                </div>
            `;
            input.value = '';
            history.scrollTop = history.scrollHeight;

            // Loading
            const loadingId = 'loading-' + Date.now();
            history.innerHTML += `
                <div id="${loadingId}" class="flex items-start gap-3 animate-fadeIn">
                    <div class="bg-indigo-600 p-1.5 rounded-lg text-xs text-white">AI</div>
                    <div class="bg-white border border-slate-200 p-3 rounded-2xl rounded-tl-none text-sm text-slate-500 italic shadow-sm">
                        Consulting knowledge base...
                    </div>
                </div>
            `;
            history.scrollTop = history.scrollHeight;

            // Context Prompt
            const context = `
                You are the "Project Aether" AI Strategist for Core Banking.
                Data Context:
                - Focus: AI and GenAI impact on the banking value chain.
                - Players: ${JSON.stringify(players.map(p => p.name))}
                - Key Themes: Probabilistic vs Deterministic, Upstream Tax, Copilot Efficiency.
                
                User Question: ${query}
                
                Style: Expert, succinct, analytical. Use markdown bolding.
                Constraint: Do not hallucinate data. If unknown, say so.
            `;

            const response = await callGemini(context);
            document.getElementById(loadingId).remove();

            history.innerHTML += `
                <div class="flex items-start gap-3 animate-fadeIn">
                    <div class="bg-indigo-600 p-1.5 rounded-lg text-xs text-white">AI</div>
                    <div class="bg-white border border-slate-200 p-3 rounded-2xl rounded-tl-none text-sm text-slate-800 shadow-sm prose prose-sm prose-indigo">
                        ${marked.parse(response)}
                    </div>
                </div>
            `;
            history.scrollTop = history.scrollHeight;
        }

        async function generateThesis(playerName) {
            const player = players.find(p => p.name === playerName);
            const modal = document.getElementById('thesis-modal');
            const title = document.getElementById('thesis-title');
            const content = document.getElementById('thesis-content');

            title.textContent = `AI Readiness Scorecard: ${playerName}`;
            content.innerHTML = `
                <div class="flex flex-col items-center justify-center py-12 space-y-4">
                    <div class="animate-spin rounded-full h-10 w-10 border-4 border-indigo-100 border-t-indigo-600"></div>
                    <p class="text-slate-500 font-medium">Evaluating AI Strategy & Technical Debt...</p>
                </div>
            `;
            modal.classList.remove('hidden');

            const prompt = `
                Act as a specialized AI Equity Analyst. Create an "AI Readiness Scorecard" for ${player.name} in the Banking sector.
                
                Input Data:
                - Role: ${player.type}
                - Stated Strategy: ${player.ai_strat}
                - Risk: ${player.risk}
                
                Output Format (Markdown):
                1. **AI Exposure Rating** (High/Med/Low): Justification.
                2. **The "Moat" Assessment**: Is AI weakening or strengthening their moat? (e.g., if they are a BPO, AI hurts them. If they are a Chip maker, AI helps).
                3. **Strategic Verdict**: Buy/Hold/Sell based on AI headwinds/tailwinds.
            `;

            const response = await callGemini(prompt);
            content.innerHTML = marked.parse(response);
        }

        function closeThesisModal() {
            document.getElementById('thesis-modal').classList.add('hidden');
        }

        // --- CHARTS ---

        function initCharts() {
            // Chart 1: Impact vs Risk (Scatter)
            const ctxImpact = document.getElementById('impactMap').getContext('2d');
            new Chart(ctxImpact, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Use Cases',
                        data: [
                            { x: 10, y: 90, name: 'Marketing / CX' },       // Low Risk, High Value
                            { x: 20, y: 80, name: 'Code Migration' },       // Low-Med Risk, High Value
                            { x: 40, y: 70, name: 'Fraud Detection' },      // Med Risk, Med Value
                            { x: 60, y: 40, name: 'Advisory / Wealth' },    // Med-High Risk (Advice), Med Value
                            { x: 95, y: 20, name: 'Ledger Processing' }     // Extreme Risk, Low Value (Deterministic better)
                        ],
                        backgroundColor: '#4f46e5',
                        pointRadius: 8,
                        pointHoverRadius: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: { callbacks: { label: ctx => ctx.raw.name } },
                        legend: { display: false }
                    },
                    scales: {
                        x: { title: { display: true, text: 'Regulatory/Hallucination Risk' }, min: 0, max: 100 },
                        y: { title: { display: true, text: 'Business Value (ROI)' }, min: 0, max: 100 }
                    }
                }
            });

            // Chart 2: Budget Shift (Stacked Bar)
            const ctxBudget = document.getElementById('budgetShift').getContext('2d');
            new Chart(ctxBudget, {
                type: 'bar',
                data: {
                    labels: ['2023', '2024', '2025E', '2027E'],
                    datasets: [
                        { label: 'Generative AI / R&D', data: [5, 12, 25, 40], backgroundColor: '#6366f1' }, // Indigo
                        { label: 'Cyber / Cloud / Data', data: [35, 38, 35, 30], backgroundColor: '#94a3b8' }, // Slate 400
                        { label: 'Legacy Maintenance', data: [60, 50, 40, 30], backgroundColor: '#cbd5e1' } // Slate 300
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { stacked: true },
                        y: { stacked: true, max: 100, title: { display: true, text: '% of IT Budget' } }
                    }
                }
            });
        }

        // --- INIT ---

        document.addEventListener('DOMContentLoaded', () => {
            initLanes();
            renderPlayers();
            initCharts();
            switchTab('usecases', document.querySelector('.tab-btn'));

            document.getElementById('player-filter').addEventListener('change', (e) => {
                renderPlayers(e.target.value);
            });
        });

        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>

</html>